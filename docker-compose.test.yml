version: '3.8'

# Docker Compose for Test Database
# Usage: docker-compose -f docker-compose.test.yml up -d
# This creates a PostgreSQL instance for running tests locally

services:
  postgres:
    image: postgres:15
    container_name: pr-manager-test-db

    environment:
      # PostgreSQL Configuration
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: pr_manager_test
      POSTGRES_INITDB_ARGS: "-c password_encryption=scram-sha-256"

      # Optional: Set timezone
      TZ: UTC

    ports:
      # Map PostgreSQL port
      # Host:Container
      - "5432:5432"

    volumes:
      # Persist database data across container restarts
      - postgres_data:/var/lib/postgresql/data

      # Initialize with custom scripts (optional)
      # - ./scripts/init-db.sql:/docker-entrypoint-initdb.d/init.sql

    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 10s

    networks:
      - test-network

    restart: unless-stopped

volumes:
  postgres_data:
    driver: local

networks:
  test-network:
    driver: bridge
