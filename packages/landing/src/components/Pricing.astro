---
const plans = [
  {
    name: 'Monthly',
    price: '2.99',
    currency: '€',
    period: '/month',
    description: 'Flexible access for individual developers.',
    features: [
      'Unlimited PR Dashboards',
      'Custom Filter Views',
      'Native Desktop Notifications',
      'GitHub & GitLab Support',
      'CI/CD Status Integration',
    ],
    cta: 'Start Monthly Plan',
    featured: false,
  },
  {
    name: 'Annual',
    price: '29.99',
    currency: '€',
    period: '/year',
    description: 'Maximum value, best performance.',
    features: [
      'All Monthly Features',
      'Priority Cloud Sync',
      'Early Beta Access',
      'VIP Priority Support',
      'Save 17% vs Monthly',
    ],
    cta: 'Start Annual Plan',
    featured: true,
    savings: 'Save 17%',
  },
];
---

<section id="pricing" class="py-24 md:py-[100px] bg-background-alt" aria-labelledby="pricing-heading">
  <div class="max-w-7xl mx-auto px-6 lg:px-[120px]">
    <!-- Section Header -->
    <div class="text-center mb-16 animate-on-scroll">
      <h2 id="pricing-heading" class="text-4xl md:text-[48px] font-bold leading-tight text-foreground mb-4">
        Simple, transparent pricing.
      </h2>
      <p class="text-lg md:text-xl text-foreground-secondary max-w-[500px] mx-auto leading-relaxed">
        Unlock full productivity with our pro features. Start with a 7-day free trial.
      </p>
    </div>

    <!-- Pricing Cards -->
    <div class="flex flex-col md:flex-row gap-8 justify-center items-stretch max-w-[800px] mx-auto">
      {plans.map((plan) => (
        <div
          class={`relative p-10 rounded-3xl w-full md:w-[380px] transition-all duration-300 hover:-translate-y-2 ${
            plan.featured
              ? 'glass-card border-2 border-primary bg-gradient-to-br from-primary/5 to-accent/5'
              : 'glass-card'
          }`}
        >
          {/* Best Value Badge */}
          {plan.featured && (
            <div class="absolute -top-4 left-1/2 -translate-x-1/2">
              <span class="px-4 py-1.5 bg-gradient-to-r from-primary to-accent text-white text-xs font-bold rounded-full uppercase tracking-wide">
                Best Value
              </span>
            </div>
          )}

          {/* Free Trial Badge */}
          <div class="absolute -top-3 right-6">
            <span class={`px-3 py-1 rounded-full text-xs font-semibold ${
              plan.featured
                ? 'bg-accent text-white'
                : 'bg-foreground text-background dark:bg-white dark:text-black'
            }`}>
              7-day free trial
            </span>
          </div>

          {/* Plan Info */}
          <div class="mb-8 pt-2">
            <h3 class="text-xl font-bold text-foreground mb-2">{plan.name}</h3>
            <p class="text-foreground-secondary text-sm">{plan.description}</p>
          </div>

          {/* Price */}
          <div class="mb-8">
            <div class="flex items-baseline">
              <span class="text-5xl font-bold text-foreground">{plan.price}{plan.currency}</span>
              <span class="text-foreground-muted ml-2 font-medium text-sm">{plan.period}</span>
            </div>
            {plan.savings && (
              <div class="mt-3">
                <span class="inline-block px-3 py-1 bg-success/10 text-success text-xs font-semibold rounded-md">
                  {plan.savings}
                </span>
              </div>
            )}
          </div>

          {/* Features List */}
          <ul class="space-y-4 mb-8">
            {plan.features.map((feature) => (
              <li class="flex items-center gap-3 text-foreground-secondary">
                <svg class={`w-5 h-5 flex-shrink-0 ${plan.featured ? 'text-primary' : 'text-success'}`} fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 13l4 4L19 7"/>
                </svg>
                <span class="text-sm">{feature}</span>
              </li>
            ))}
          </ul>

          {/* CTA Button */}
          <button
            class={`w-full py-4 px-6 rounded-xl text-center font-semibold text-base transition-all duration-300 ${
              plan.featured
                ? 'bg-gradient-to-r from-accent-purple to-accent text-white shadow-lg hover:shadow-xl hover:-translate-y-0.5'
                : 'btn-secondary'
            }`}
            data-price-id={plan.name.toLowerCase()}
            aria-label={`${plan.cta} - ${plan.price}${plan.currency}${plan.period} with 7-day free trial`}
          >
            {plan.cta}
          </button>
        </div>
      ))}
    </div>

    {/* Trust Text */}
    <div class="flex items-center justify-center gap-2 mt-12 text-sm text-foreground-muted animate-on-scroll">
      <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
      </svg>
      <span>Secure payments via LemonSqueezy. Cancel anytime during your trial.</span>
    </div>

    {/* FAQ Section */}
    <div class="mt-24 max-w-[800px] mx-auto">
      <h3 id="faq-heading" class="text-3xl md:text-[40px] font-bold text-foreground text-center mb-12 animate-on-scroll">
        Frequently Asked Questions
      </h3>

      <div class="divide-y divide-border" role="region" aria-labelledby="faq-heading">
        <details class="group py-6 animate-on-scroll">
          <summary class="flex items-center justify-between cursor-pointer text-foreground font-medium hover:text-primary transition-colors">
            <span>Can I use PR Manager with private repositories?</span>
            <svg class="w-5 h-5 text-foreground-muted group-open:rotate-180 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </summary>
          <div class="mt-4 text-foreground-secondary leading-relaxed">
            Yes! PR Manager works with both public and private repositories on GitHub and GitLab. Your credentials are securely stored locally on your device.
          </div>
        </details>

        <details class="group py-6 animate-on-scroll">
          <summary class="flex items-center justify-between cursor-pointer text-foreground font-medium hover:text-primary transition-colors">
            <span>What happens after the free trial?</span>
            <svg class="w-5 h-5 text-foreground-muted group-open:rotate-180 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </summary>
          <div class="mt-4 text-foreground-secondary leading-relaxed">
            After your 7-day free trial, you'll be charged for your selected plan. You can cancel anytime before the trial ends without being charged.
          </div>
        </details>

        <details class="group py-6 animate-on-scroll">
          <summary class="flex items-center justify-between cursor-pointer text-foreground font-medium hover:text-primary transition-colors">
            <span>Do you offer refunds?</span>
            <svg class="w-5 h-5 text-foreground-muted group-open:rotate-180 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </summary>
          <div class="mt-4 text-foreground-secondary leading-relaxed">
            We offer a 30-day money-back guarantee. If you're not satisfied with PR Manager, contact our support team for a full refund.
          </div>
        </details>

        <details class="group py-6 animate-on-scroll">
          <summary class="flex items-center justify-between cursor-pointer text-foreground font-medium hover:text-primary transition-colors">
            <span>Can I switch between monthly and annual plans?</span>
            <svg class="w-5 h-5 text-foreground-muted group-open:rotate-180 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
            </svg>
          </summary>
          <div class="mt-4 text-foreground-secondary leading-relaxed">
            Yes! You can upgrade or downgrade your plan at any time. Changes will take effect at the start of your next billing cycle.
          </div>
        </details>
      </div>
    </div>
  </div>

  <!-- FAQPage Structured Data -->
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [
        {
          "@type": "Question",
          "name": "Can I use PR Manager with private repositories?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Yes! PR Manager works with both public and private repositories on GitHub and GitLab. Your credentials are securely stored locally on your device."
          }
        },
        {
          "@type": "Question",
          "name": "What happens after the free trial?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "After your 7-day free trial, you'll be charged for your selected plan. You can cancel anytime before the trial ends without being charged."
          }
        },
        {
          "@type": "Question",
          "name": "Do you offer refunds?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "We offer a 30-day money-back guarantee. If you're not satisfied with PR Manager, contact our support team for a full refund."
          }
        },
        {
          "@type": "Question",
          "name": "Can I switch between monthly and annual plans?",
          "acceptedAnswer": {
            "@type": "Answer",
            "text": "Yes! You can upgrade or downgrade your plan at any time. Changes will take effect at the start of your next billing cycle."
          }
        }
      ]
    }
  </script>
</section>

<script>
  document.querySelectorAll('[data-price-id]').forEach((button) => {
    button.addEventListener('click', () => {
      const priceId = button.getAttribute('data-price-id');

      // Check if user is already logged in
      const token = localStorage.getItem('pr_manager_token') || localStorage.getItem('pr_manager_token');

      if (token) {
        // If logged in, go directly to checkout
        window.location.href = `/checkout?plan=${priceId}`;
      } else {
        // If not logged in, go to signup first
        window.location.href = `/signup?plan=${priceId}`;
      }
    });
  });
</script>
